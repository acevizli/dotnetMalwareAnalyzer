import os
import sys
import subprocess
folder = sys.argv[1]
dotnets = []
files = [f for f in os.listdir(folder) if f.endswith('.exe')]
print("------------------------------------------------------------------")
for file in files:
    stream = os.popen("C:\\Users\\IEUser\\Downloads\\die_win64_portable_3.03\\diec.exe -d {}".format(folder +"\\"+ file))
    output = stream.readlines()
    print(file)
    for o in output:
        print(o, end = '')
        if "library: .NET" in o:
            dotnets.append(file)
    os.system("C:\\Users\\IEUser\\Downloads\\die_win64_portable_3.03\\diec.exe -e {}".format(folder +"\\"+ file))
    print("------------------------------------------------------------------\n")

for dotnet in dotnets:
    proc = subprocess.Popen(["powershell",".\Demo.ps1 {} > {}.txt".format(folder + "\\"+dotnet,dotnet+"_BaseCode")])
    proc.communicate()