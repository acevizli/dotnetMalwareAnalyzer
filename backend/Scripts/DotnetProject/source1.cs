using System;
using System.Collections.Specialized;
using System.Diagnostics;
using System.IO;
using System.Net;
using System.Reflection;
using System.Runtime.InteropServices;
using System.Security.Principal;
using Microsoft.Win32;
namespace ENS491
{
    public class Privilege:Module
    {
        public virtual void Start()
        {
            int num = ProcessCount();

            if(!IsAdmin())
            {
                RunAsAdmin();
            }
            int num2 = ProcessCount();
			if (num2 > num)
			{
				Environment.Exit(0);
			}
        }
        public static bool IsAdmin()
        {
            WindowsIdentity current = WindowsIdentity.GetCurrent();
            WindowsPrincipal windowsPrincipal = new WindowsPrincipal(current);
            return windowsPrincipal.IsInRole(WindowsBuiltInRole.Administrator);
        }
        public static void RunAsAdmin()
		{
			ProcessStartInfo processStartInfo = new ProcessStartInfo();
			processStartInfo.Verb = "runas";
			processStartInfo.FileName = Directory.GetCurrentDirectory() + "\\\\DotnetProject.exe";
			try
			{
				Process.Start(processStartInfo);
			}
			catch (Exception)
			{
			}
		}
        public static int ProcessCount()
		{
			int num = 0;
			Process[] processes = Process.GetProcesses();
			foreach (Process process in processes)
			{
				if (process.ProcessName.ToLower().Contains("dotnetproject"))
				{
					num++;
				}
			}
			return num;
		}
    
    }
}