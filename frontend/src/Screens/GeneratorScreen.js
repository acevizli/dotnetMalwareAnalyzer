import React, { useState, useEffect } from "react";
import {
  InputGroup,
  Container,
  Form,
  Button,
  FormControl,
  Alert,
  Col,
  Row,
} from "react-bootstrap";
import axios from "axios";
function GeneratorScreen() {
  const [message, setMessage] = useState("");
  const [error, setError] = useState(false);
  const [errorMessage, setErrorMessage] = useState("");
  const [checked, setChecked] = useState(false);

  const submitHandler = async (e) => {
    e.preventDefault();
    const modules = [];
    const array = message.split(" ");
    console.log(message);
    array.forEach(myFunction);

    function myFunction(value) {
      const j = { id: value };
      modules.push(j);
    }
    const json = { modules: modules, obfuscate: checked };
    console.log(json);
    axios
      .post("api/create/", json, {
        responseType: "arraybuffer",
        headers: {
          "Content-Type": "application/json",
        },
      })
      .then((response) => {
        const type = response.headers["content-type"];
        const blob = new Blob([response.data], {
          type: type,
          encoding: "UTF-8",
        });
        const link = document.createElement("a");
        link.href = window.URL.createObjectURL(blob);
        link.download = "malware.zip";
        link.click();
      })
      .catch((error) => {
        setError(true);
        setErrorMessage(error.message);
      });
  };
  return (
    <Form onSubmit={submitHandler}>
      {error && <Alert variant="danger">{errorMessage}</Alert>}
      <Container>
        <InputGroup className="mb-3">
          <InputGroup.Text id="basic-addon2">example: 1 5 10</InputGroup.Text>
          <FormControl
            placeholder="Modules id's"
            aria-label="Modules id's"
            aria-describedby="basic-addon2"
            value={message}
            onChange={(e) => setMessage(e.target.value)}
          />
        </InputGroup>
      </Container>
      <Container>
        <Row xs="auto">
          <Col sm={2}>
            <InputGroup.Text id="basic-addon2">obfuscate</InputGroup.Text>
          </Col>
          <Col sm={1}>
            <InputGroup.Checkbox
              type="radio"
              aria-label="Radio button for following text input"
              checked={checked}
              onChange={(e) => setChecked(e.target.checked)}
            ></InputGroup.Checkbox>
          </Col>
        </Row>
      </Container>

      <Button type="submit" variant="primary">
        Generate
      </Button>
    </Form>
  );
}

export default GeneratorScreen;
